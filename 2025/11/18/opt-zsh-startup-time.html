
<!DOCTYPE html>
<html lang='en-US'>
<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Optimize zsh startup time</title>
  <meta name="description" content="æœ€è¿‘å‘ç°zshå¯åŠ¨è¶Šæ¥è¶Šæ…¢ï¼Œæœ€ç»ˆå®šä½åˆ°ä¸€ä¸ªå¾ˆå¥‡å¦™çš„åŸå› ã€‚">
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="canonical" href="https://eluvk.github.io/2025/11/18/opt-zsh-startup-time.html">
  <link rel="alternate" type="application/rss+xml" title="EluvK" href="https://eluvk.github.io/feed.xml">
  <style>
  @font-face {
    font-family: 'Open Sans'; src: url('/css/OpenSans-300-Normal.woff2') format('woff2');
    font-weight: 300; font-style: normal;
  }
  @font-face {
    font-family: 'JetBrains Mono'; src: url('/css/JetBrainsMono-400-Normal.woff2') format('woff2');
    font-weight: 400; font-style: normal;
  }
  @font-face {
    font-family: 'JetBrains Mono'; src: url('/css/JetBrainsMono-700-Normal.woff2') format('woff2');
    font-weight: 700; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-400-Normal.woff2') format('woff2');
    font-weight: 400; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-400-Italic.woff2') format('woff2');
    font-weight: 400; font-style: italic;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-700-Normal.woff2') format('woff2');
    font-weight: 700; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-700-Italic.woff2') format('woff2');
    font-weight: 700; font-style: italic;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; margin-block-start: 0; margin-block-end: 0; }

  body {
    max-width: 100ch;
    padding: 4ch;
    margin-left: auto;
    margin-right: auto;
  }

  header { margin-bottom: 2rem; }
  header > nav { display: flex; column-gap: 2ch; align-items: baseline; flex-wrap: wrap; }
  header a { font-style: normal; color: rgba(0, 0, 0, .8); text-decoration: none; }
  header a:hover { color: rgba(0, 0, 0, .8); text-decoration: underline; }
  header .title { font-size: 1.25em; flex-grow: 2; }

  footer { margin-top: 2rem; }
  footer > p { display: flex; column-gap: 2ch; justify-content: center; flex-wrap: wrap; }
  footer a { color: rgba(0, 0, 0, .8); text-decoration: none; white-space: nowrap; }
  footer i { vertical-align: middle; color: rgba(0, 0, 0, .8) }

  </style>

  <link rel="stylesheet" href="/css/main.css">
  
  <script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
  <header>
    <nav>
      <a class="title" href="/">EluvK</a>
      <a href="/shortcuts.html">ShortCuts</a>
      <a href="/about.html">About</a>
      <!-- 
      <a href="/resume.html">Resume</a>
      <a href="/links.html">Links</a> 
      -->
    </nav>
  </header>

  <main>
  <article >

    <h1>
    <a href="#Optimize-zsh-startup-time"><span>Optimize zsh startup time</span> <time datetime="2025-11-18">Nov 18, 2025</time></a>
    </h1>
<p><span>æœ€è¿‘å‘ç°zshå¯åŠ¨è¶Šæ¥è¶Šæ…¢ï¼Œæœ€ç»ˆå®šä½åˆ°ä¸€ä¸ªå¾ˆå¥‡å¦™çš„åŸå› ã€‚</span></p>
<p><span>TLDR: fpath æ›´æ–°å¯¼è‡´ zsh ä¼šé‡åš compinit çš„ç¼“å­˜ï¼Œä»è€Œæ‹–æ…¢å¯åŠ¨é€Ÿåº¦ã€‚</span></p>
<p><span>å› ä¸ºä¸€äº›åŸå› ï¼Œæœ€è¿‘åœ¨é¢‘ç¹ä¿®æ”¹ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ¯æ¬¡åœ¨æ–‡ä»¶é‡Œä¿®æ”¹å®Œæˆ‘ä¹ æƒ¯æ˜¯åœ¨å½“å‰ç»ˆç«¯æ‰§è¡Œ </span><code>source ~/.zshrc</code><span> æ¥åŠ è½½æœ€æ–°çš„é…ç½®è€Œä¸æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ã€‚ç„¶é¹…è¿™ä¸ªè¿‡ç¨‹ä¼šå†æ¬¡åŠ è½½ zsh çš„æ‰€æœ‰æ’ä»¶åˆ° fpath å˜é‡ä¸­ï¼Œå¯¼è‡´ fpath é‡Œå‡ºç°äº†é‡å¤çš„è·¯å¾„ã€‚è€Œæ¯æ¬¡ fpath å˜åŒ–ï¼Œzsh éƒ½ä¼šè®¤ä¸ºéœ€è¦é‡æ–°ç”Ÿæˆ compinit çš„ç¼“å­˜æ–‡ä»¶ï¼Œè€Œä½ ä¸‹ä¸€æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯æ—¶ï¼Œfpathåˆæ¢å¤æ­£å¸¸ï¼ˆä¹Ÿå˜åŒ–äº†ï¼‰ï¼Œzsh å°±åˆä¼šé‡æ–°æ‰§è¡Œ compinit çš„è¿‡ç¨‹ã€‚</span></p>
<p><span>quote from Mr.GPT</span></p>

<figure class="blockquote">
<blockquote><p><span>ğŸš¨ ä½ çš„ fpath è¢«é‡å¤æ³¨å…¥äº†åŒæ ·çš„ç›®å½• 4 æ¬¡ä»¥ä¸Š </span>&hellip;</p>
</blockquote>

</figure>
<p><span>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨åŠ è½½æ’ä»¶å‰ï¼Œå…ˆç”¨ </span><code>typeset -U fpath</code><span> æ¥å»é‡ fpath å˜é‡å³å¯ã€‚</span></p>
<p><span>æœ€ç»ˆçš„ ~/.zshrc ç›¸å…³éƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼Œå±•ç¤ºå¯åŠ¨æ—¶é—´è€—æ—¶çš„å‘½ä»¤ </span><code>zmodload zsh/zprof</code><span> / </span><code>zprof</code><span> å–æ¶ˆæ³¨é‡Šå°±å¯ä»¥çœ‹åˆ°å¯åŠ¨æ—¶æ¯ä¸ªæ­¥éª¤çš„è€—æ—¶ã€‚</span></p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-comment"># --- file start</span></span>
<span class="line"><span class="hl-comment"># perf start</span></span>
<span class="line"><span class="hl-comment"># zmodload zsh/zprof</span></span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Disable compinit security check &amp;&amp; disable auto update</span></span>
<span class="line">ZSH_DISABLE_COMPFIX=<span class="hl-string">&quot;true&quot;</span></span>
<span class="line">DISABLE_AUTO_UPDATE=<span class="hl-string">&quot;true&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># ....everything else...</span></span>
<span class="line"></span>
<span class="line"><span class="hl-built_in">typeset</span> -U fpath</span>
<span class="line"></span>
<span class="line">plugins=(git virtualenv zsh-autosuggestions zsh-syntax-highlighting)</span>
<span class="line"></span>
<span class="line"><span class="hl-built_in">source</span> <span class="hl-variable">$ZSH</span>/oh-my-zsh.sh</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># perf end</span></span>
<span class="line"><span class="hl-comment"># zprof</span></span></code></pre>

</figure>
<p><span>æ³¨ï¼šcompinit ç¼“å­˜æ–‡ä»¶åœ¨ </span><code>~/.zcompdump*</code><span>ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤å®ƒæ¥å¼ºåˆ¶ zsh é‡æ–°ç”Ÿæˆç¼“å­˜æ–‡ä»¶ã€‚</span></p>
</article>
  </main>

  <footer class="site-footer">
    <p>
      <a href="https://github.com/EluvK/eluvk.github.io/edit/master/content/posts/2025-11-18-opt-zsh-startup-time.dj">
        <svg class="icon"><use href="/assets/icons.svg#edit"/></svg>
        Fix typo
      </a>
      <a href="/feed.xml">
        <svg class="icon"><use href="/assets/icons.svg#rss"/></svg>
        Subscribe
      </a>
      <a href="mailto:eluvk.dev+blog@gmail.com">
        <svg class="icon"><use href="/assets/icons.svg#email"/></svg>
        Get in touch
      </a>
      <a href="https://github.com/EluvK">
        <svg class="icon"><use href="/assets/icons.svg#github"/></svg>
        EluvK
      </a>
    </p>
  </footer>
</body>

</html>
